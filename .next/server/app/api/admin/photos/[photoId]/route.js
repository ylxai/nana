(()=>{var e={};e.id=746,e.ids=[746],e.modules={517:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},4300:e=>{"use strict";e.exports=require("buffer")},6113:e=>{"use strict";e.exports=require("crypto")},2361:e=>{"use strict";e.exports=require("events")},3685:e=>{"use strict";e.exports=require("http")},5687:e=>{"use strict";e.exports=require("https")},1808:e=>{"use strict";e.exports=require("net")},5477:e=>{"use strict";e.exports=require("punycode")},2781:e=>{"use strict";e.exports=require("stream")},4404:e=>{"use strict";e.exports=require("tls")},7310:e=>{"use strict";e.exports=require("url")},9796:e=>{"use strict";e.exports=require("zlib")},8359:()=>{},3739:()=>{},216:(e,t,r)=>{"use strict";r.r(t),r.d(t,{headerHooks:()=>f,originalPathname:()=>w,patchFetch:()=>v,requestAsyncStorage:()=>u,routeModule:()=>p,serverHooks:()=>h,staticGenerationAsyncStorage:()=>m,staticGenerationBailout:()=>g});var s={};r.r(s),r.d(s,{DELETE:()=>c});var o=r(5419),a=r(9108),i=r(9678),n=r(8070),l=r(6176),d=r(6517);async function c(e,{params:t}){try{let e=t.photoId,r=await l.F.getPhotoById(e);if(!r)return n.Z.json({message:"Photo not found"},{status:404});let s=r.url.split("/"),o=s.findIndex(e=>"public"===e)+1;if(o>0&&o<s.length){let e=s.slice(o+1).join("/");try{await (0,d._I)(e)}catch(e){console.warn("Could not delete file from storage:",e)}}return await l.F.deletePhoto(e),n.Z.json({message:"Photo deleted successfully"})}catch(e){return console.error("Delete photo error:",e),n.Z.json({message:"Failed to delete photo",error:e.message},{status:400})}}let p=new o.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/admin/photos/[photoId]/route",pathname:"/api/admin/photos/[photoId]",filename:"route",bundlePath:"app/api/admin/photos/[photoId]/route"},resolvedPagePath:"/workspace/src/app/api/admin/photos/[photoId]/route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:u,staticGenerationAsyncStorage:m,serverHooks:h,headerHooks:f,staticGenerationBailout:g}=p,w="/api/admin/photos/[photoId]/route";function v(){return(0,i.patchFetch)({serverHooks:h,staticGenerationAsyncStorage:m})}},6176:(e,t,r)=>{"use strict";r.d(t,{F:()=>a});var s=r(6517);class o{async createEvent(e){let t=crypto.randomUUID(),r=`http://localhost:3000/event/${t}`,o=`https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=${encodeURIComponent(r)}`,{data:a,error:i}=await s.pR.from("events").insert({id:t,name:e.name,date:e.date,qr_code:o,shareable_link:r,access_code:e.access_code||"GUEST",is_premium:e.is_premium||!1}).select().single();if(i)throw Error(`Create event failed: ${i.message}`);return a}async getEventById(e){let{data:t,error:r}=await s.pR.from("events").select("*").eq("id",e).single();if(r&&"PGRST116"!==r.code)throw Error(`Get event failed: ${r.message}`);return t}async getAllEvents(){let{data:e,error:t}=await s.pR.from("events").select("*").order("created_at",{ascending:!1});if(t)throw Error(`Get events failed: ${t.message}`);return e||[]}async updateEvent(e,t){let{data:r,error:o}=await s.pR.from("events").update(t).eq("id",e).select().single();if(o)throw Error(`Update event failed: ${o.message}`);return r}async deleteEvent(e){await s.pR.from("photos").delete().eq("event_id",e),await s.pR.from("messages").delete().eq("event_id",e);let{error:t}=await s.pR.from("events").delete().eq("id",e);if(t)throw Error(`Delete event failed: ${t.message}`)}async createPhoto(e){let{data:t,error:r}=await s.pR.from("photos").insert({id:crypto.randomUUID(),event_id:e.event_id,filename:e.filename,original_name:e.original_name,url:e.url,uploader_name:e.uploader_name||null,album_name:e.album_name||"Tamu",likes:0}).select().single();if(r)throw Error(`Create photo failed: ${r.message}`);return t}async getEventPhotos(e){let{data:t,error:r}=await s.pR.from("photos").select("*").eq("event_id",e).order("uploaded_at",{ascending:!1});if(r)throw Error(`Get photos failed: ${r.message}`);return t||[]}async getHomepagePhotos(){let{data:e,error:t}=await s.pR.from("photos").select("*").eq("event_id","homepage").order("uploaded_at",{ascending:!1});if(t)throw Error(`Get homepage photos failed: ${t.message}`);return e||[]}async getPhotoById(e){let{data:t,error:r}=await s.pR.from("photos").select("*").eq("id",e).single();if(r&&"PGRST116"!==r.code)throw Error(`Get photo failed: ${r.message}`);return t}async deletePhoto(e){let{error:t}=await s.pR.from("photos").delete().eq("id",e);if(t)throw Error(`Delete photo failed: ${t.message}`)}async getRecentPhotos(e=8){let{data:t,error:r}=await s.pR.from("photos").select("*").order("uploaded_at",{ascending:!1}).limit(e);if(r)throw Error(`Get recent photos failed: ${r.message}`);return t||[]}async createMessage(e){let{data:t,error:r}=await s.pR.from("messages").insert({id:crypto.randomUUID(),event_id:e.event_id,guest_name:e.guest_name,message:e.message,hearts:0}).select().single();if(r)throw Error(`Create message failed: ${r.message}`);return t}async getEventMessages(e){let{data:t,error:r}=await s.pR.from("messages").select("*").eq("event_id",e).order("created_at",{ascending:!1});if(r)throw Error(`Get messages failed: ${r.message}`);return t||[]}async updateMessageHearts(e,t){let{error:r}=await s.pR.from("messages").update({hearts:t}).eq("id",e);if(r)throw Error(`Update message hearts failed: ${r.message}`)}async getStats(){let[e,t,r]=await Promise.all([s.pR.from("events").select("id",{count:"exact",head:!0}),s.pR.from("photos").select("id",{count:"exact",head:!0}),s.pR.from("messages").select("id",{count:"exact",head:!0})]);if(e.error)throw Error(`Get events count failed: ${e.error.message}`);if(t.error)throw Error(`Get photos count failed: ${t.error.message}`);if(r.error)throw Error(`Get messages count failed: ${r.error.message}`);return{totalEvents:e.count||0,totalPhotos:t.count||0,totalMessages:r.count||0}}}let a=new o},6517:(e,t,r)=>{"use strict";r.d(t,{$6:()=>a,FW:()=>l,_I:()=>n,cT:()=>i,pR:()=>o});var s=r(1971);(0,s.eI)("https://azspktldiblhrwebzmwq.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImF6c3BrdGxkaWJsaHJ3ZWJ6bXdxIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTM5NDQwNDQsImV4cCI6MjA2OTUyMDA0NH0.uKHB4K9hxUDTc0ZkwidCJv_Ev-oa99AflFvrFt_8MG8");let o=(0,s.eI)("https://azspktldiblhrwebzmwq.supabase.co",process.env.SUPABASE_SERVICE_ROLE_KEY,{auth:{autoRefreshToken:!1,persistSession:!1}}),a=process.env.SUPABASE_STORAGE_BUCKET||"hafiportrait-photos";async function i(e,t){let{data:r,error:s}=await o.storage.from(a).upload(t,e,{cacheControl:"3600",upsert:!1});if(s)throw Error(`Upload failed: ${s.message}`);let{data:i}=o.storage.from(a).getPublicUrl(r.path);return i.publicUrl}async function n(e){let{error:t}=await o.storage.from(a).remove([e]);if(t)throw Error(`Delete failed: ${t.message}`)}function l(e,t,r){let s=Date.now(),o=Math.random().toString(36).substring(2,8),a=t.split(".").pop(),i=`${s}_${o}.${a}`;return r?`${e}/${r}/${i}`:`${e}/${i}`}}};var t=require("../../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[638,249],()=>r(216));module.exports=s})();