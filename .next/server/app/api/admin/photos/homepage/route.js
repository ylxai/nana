(()=>{var e={};e.id=279,e.ids=[279],e.modules={517:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},4300:e=>{"use strict";e.exports=require("buffer")},6113:e=>{"use strict";e.exports=require("crypto")},2361:e=>{"use strict";e.exports=require("events")},3685:e=>{"use strict";e.exports=require("http")},5687:e=>{"use strict";e.exports=require("https")},1808:e=>{"use strict";e.exports=require("net")},5477:e=>{"use strict";e.exports=require("punycode")},2781:e=>{"use strict";e.exports=require("stream")},4404:e=>{"use strict";e.exports=require("tls")},7310:e=>{"use strict";e.exports=require("url")},9796:e=>{"use strict";e.exports=require("zlib")},8359:()=>{},3739:()=>{},404:(e,t,r)=>{"use strict";r.r(t),r.d(t,{headerHooks:()=>f,originalPathname:()=>v,patchFetch:()=>_,requestAsyncStorage:()=>u,routeModule:()=>c,serverHooks:()=>g,staticGenerationAsyncStorage:()=>h,staticGenerationBailout:()=>w});var a={};r.r(a),r.d(a,{GET:()=>m,POST:()=>d});var s=r(5419),o=r(9108),i=r(9678),n=r(8070),l=r(6176),p=r(6517);async function m(){try{let e=await l.F.getHomepagePhotos();return n.Z.json(e)}catch(e){return console.error("Get homepage photos error:",e),n.Z.json({message:"Failed to fetch homepage photos",error:e.message},{status:400})}}async function d(e){try{let t=await e.formData(),r=t.get("photo");if(t.get("albumName"),!r)return n.Z.json({message:"No photo file provided"},{status:400});if(r.size>10485760)return n.Z.json({message:"File size too large. Maximum 10MB allowed."},{status:400});if(!r.type.startsWith("image/"))return n.Z.json({message:"Only image files are allowed"},{status:400});let a=(0,p.FW)("homepage",r.name),s=await (0,p.cT)(r,a),o=await l.F.createPhoto({event_id:"homepage",filename:a.split("/").pop(),original_name:r.name,url:s,uploader_name:"Admin",album_name:"homepage"});return n.Z.json(o)}catch(e){return console.error("Homepage photo upload error:",e),n.Z.json({message:"Upload failed",error:e.message},{status:400})}}let c=new s.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/admin/photos/homepage/route",pathname:"/api/admin/photos/homepage",filename:"route",bundlePath:"app/api/admin/photos/homepage/route"},resolvedPagePath:"/workspace/src/app/api/admin/photos/homepage/route.ts",nextConfigOutput:"",userland:a}),{requestAsyncStorage:u,staticGenerationAsyncStorage:h,serverHooks:g,headerHooks:f,staticGenerationBailout:w}=c,v="/api/admin/photos/homepage/route";function _(){return(0,i.patchFetch)({serverHooks:g,staticGenerationAsyncStorage:h})}},6176:(e,t,r)=>{"use strict";r.d(t,{F:()=>o});var a=r(6517);class s{async createEvent(e){let t=crypto.randomUUID(),r=`http://localhost:3000/event/${t}`,s=`https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=${encodeURIComponent(r)}`,{data:o,error:i}=await a.pR.from("events").insert({id:t,name:e.name,date:e.date,qr_code:s,shareable_link:r,access_code:e.access_code||"GUEST",is_premium:e.is_premium||!1}).select().single();if(i)throw Error(`Create event failed: ${i.message}`);return o}async getEventById(e){let{data:t,error:r}=await a.pR.from("events").select("*").eq("id",e).single();if(r&&"PGRST116"!==r.code)throw Error(`Get event failed: ${r.message}`);return t}async getAllEvents(){let{data:e,error:t}=await a.pR.from("events").select("*").order("created_at",{ascending:!1});if(t)throw Error(`Get events failed: ${t.message}`);return e||[]}async updateEvent(e,t){let{data:r,error:s}=await a.pR.from("events").update(t).eq("id",e).select().single();if(s)throw Error(`Update event failed: ${s.message}`);return r}async deleteEvent(e){await a.pR.from("photos").delete().eq("event_id",e),await a.pR.from("messages").delete().eq("event_id",e);let{error:t}=await a.pR.from("events").delete().eq("id",e);if(t)throw Error(`Delete event failed: ${t.message}`)}async createPhoto(e){let{data:t,error:r}=await a.pR.from("photos").insert({id:crypto.randomUUID(),event_id:e.event_id,filename:e.filename,original_name:e.original_name,url:e.url,uploader_name:e.uploader_name||null,album_name:e.album_name||"Tamu",likes:0}).select().single();if(r)throw Error(`Create photo failed: ${r.message}`);return t}async getEventPhotos(e){let{data:t,error:r}=await a.pR.from("photos").select("*").eq("event_id",e).order("uploaded_at",{ascending:!1});if(r)throw Error(`Get photos failed: ${r.message}`);return t||[]}async getHomepagePhotos(){let{data:e,error:t}=await a.pR.from("photos").select("*").eq("event_id","homepage").order("uploaded_at",{ascending:!1});if(t)throw Error(`Get homepage photos failed: ${t.message}`);return e||[]}async getPhotoById(e){let{data:t,error:r}=await a.pR.from("photos").select("*").eq("id",e).single();if(r&&"PGRST116"!==r.code)throw Error(`Get photo failed: ${r.message}`);return t}async deletePhoto(e){let{error:t}=await a.pR.from("photos").delete().eq("id",e);if(t)throw Error(`Delete photo failed: ${t.message}`)}async getRecentPhotos(e=8){let{data:t,error:r}=await a.pR.from("photos").select("*").order("uploaded_at",{ascending:!1}).limit(e);if(r)throw Error(`Get recent photos failed: ${r.message}`);return t||[]}async createMessage(e){let{data:t,error:r}=await a.pR.from("messages").insert({id:crypto.randomUUID(),event_id:e.event_id,guest_name:e.guest_name,message:e.message,hearts:0}).select().single();if(r)throw Error(`Create message failed: ${r.message}`);return t}async getEventMessages(e){let{data:t,error:r}=await a.pR.from("messages").select("*").eq("event_id",e).order("created_at",{ascending:!1});if(r)throw Error(`Get messages failed: ${r.message}`);return t||[]}async updateMessageHearts(e,t){let{error:r}=await a.pR.from("messages").update({hearts:t}).eq("id",e);if(r)throw Error(`Update message hearts failed: ${r.message}`)}async getStats(){let[e,t,r]=await Promise.all([a.pR.from("events").select("id",{count:"exact",head:!0}),a.pR.from("photos").select("id",{count:"exact",head:!0}),a.pR.from("messages").select("id",{count:"exact",head:!0})]);if(e.error)throw Error(`Get events count failed: ${e.error.message}`);if(t.error)throw Error(`Get photos count failed: ${t.error.message}`);if(r.error)throw Error(`Get messages count failed: ${r.error.message}`);return{totalEvents:e.count||0,totalPhotos:t.count||0,totalMessages:r.count||0}}}let o=new s},6517:(e,t,r)=>{"use strict";r.d(t,{$6:()=>o,FW:()=>l,_I:()=>n,cT:()=>i,pR:()=>s});var a=r(1971);(0,a.eI)("https://azspktldiblhrwebzmwq.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImF6c3BrdGxkaWJsaHJ3ZWJ6bXdxIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTM5NDQwNDQsImV4cCI6MjA2OTUyMDA0NH0.uKHB4K9hxUDTc0ZkwidCJv_Ev-oa99AflFvrFt_8MG8");let s=(0,a.eI)("https://azspktldiblhrwebzmwq.supabase.co",process.env.SUPABASE_SERVICE_ROLE_KEY,{auth:{autoRefreshToken:!1,persistSession:!1}}),o=process.env.SUPABASE_STORAGE_BUCKET||"hafiportrait-photos";async function i(e,t){let{data:r,error:a}=await s.storage.from(o).upload(t,e,{cacheControl:"3600",upsert:!1});if(a)throw Error(`Upload failed: ${a.message}`);let{data:i}=s.storage.from(o).getPublicUrl(r.path);return i.publicUrl}async function n(e){let{error:t}=await s.storage.from(o).remove([e]);if(t)throw Error(`Delete failed: ${t.message}`)}function l(e,t,r){let a=Date.now(),s=Math.random().toString(36).substring(2,8),o=t.split(".").pop(),i=`${a}_${s}.${o}`;return r?`${e}/${r}/${i}`:`${e}/${i}`}}};var t=require("../../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[638,249],()=>r(404));module.exports=a})();