(()=>{var e={};e.id=943,e.ids=[943],e.modules={517:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},4300:e=>{"use strict";e.exports=require("buffer")},6113:e=>{"use strict";e.exports=require("crypto")},2361:e=>{"use strict";e.exports=require("events")},3685:e=>{"use strict";e.exports=require("http")},5687:e=>{"use strict";e.exports=require("https")},1808:e=>{"use strict";e.exports=require("net")},5477:e=>{"use strict";e.exports=require("punycode")},2781:e=>{"use strict";e.exports=require("stream")},4404:e=>{"use strict";e.exports=require("tls")},7310:e=>{"use strict";e.exports=require("url")},9796:e=>{"use strict";e.exports=require("zlib")},8359:()=>{},3739:()=>{},1010:(e,t,r)=>{"use strict";r.r(t),r.d(t,{headerHooks:()=>f,originalPathname:()=>w,patchFetch:()=>_,requestAsyncStorage:()=>m,routeModule:()=>u,serverHooks:()=>g,staticGenerationAsyncStorage:()=>h,staticGenerationBailout:()=>v});var s={};r.r(s),r.d(s,{GET:()=>c,POST:()=>p});var a=r(5419),o=r(9108),i=r(9678),n=r(8070),l=r(6176),d=r(6517);async function p(e,{params:t}){try{let r=t.id,s=await e.formData(),a=s.get("photo"),o=s.get("uploaderName"),i=s.get("albumName");if(!a)return n.Z.json({message:"No photo file provided"},{status:400});if(a.size>10485760)return n.Z.json({message:"File size too large. Maximum 10MB allowed."},{status:400});if(!a.type.startsWith("image/"))return n.Z.json({message:"Only image files are allowed"},{status:400});let p=(0,d.FW)("events",a.name,r),c=await (0,d.cT)(a,p),u=await l.F.createPhoto({event_id:r,filename:p.split("/").pop(),original_name:a.name,url:c,uploader_name:o||"Anonim",album_name:i||"Tamu"});return n.Z.json(u)}catch(e){return console.error("Photo upload error:",e),n.Z.json({message:"Upload failed",error:e.message},{status:400})}}async function c(e,{params:t}){try{let e=t.id,r=await l.F.getEventPhotos(e);return n.Z.json(r)}catch(e){return console.error("Get photos error:",e),n.Z.json({message:"Failed to fetch photos",error:e.message},{status:400})}}let u=new a.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/events/[id]/photos/route",pathname:"/api/events/[id]/photos",filename:"route",bundlePath:"app/api/events/[id]/photos/route"},resolvedPagePath:"/workspace/src/app/api/events/[id]/photos/route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:m,staticGenerationAsyncStorage:h,serverHooks:g,headerHooks:f,staticGenerationBailout:v}=u,w="/api/events/[id]/photos/route";function _(){return(0,i.patchFetch)({serverHooks:g,staticGenerationAsyncStorage:h})}},6176:(e,t,r)=>{"use strict";r.d(t,{F:()=>o});var s=r(6517);class a{async createEvent(e){let t=crypto.randomUUID(),r=`http://localhost:3000/event/${t}`,a=`https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=${encodeURIComponent(r)}`,{data:o,error:i}=await s.pR.from("events").insert({id:t,name:e.name,date:e.date,qr_code:a,shareable_link:r,access_code:e.access_code||"GUEST",is_premium:e.is_premium||!1}).select().single();if(i)throw Error(`Create event failed: ${i.message}`);return o}async getEventById(e){let{data:t,error:r}=await s.pR.from("events").select("*").eq("id",e).single();if(r&&"PGRST116"!==r.code)throw Error(`Get event failed: ${r.message}`);return t}async getAllEvents(){let{data:e,error:t}=await s.pR.from("events").select("*").order("created_at",{ascending:!1});if(t)throw Error(`Get events failed: ${t.message}`);return e||[]}async updateEvent(e,t){let{data:r,error:a}=await s.pR.from("events").update(t).eq("id",e).select().single();if(a)throw Error(`Update event failed: ${a.message}`);return r}async deleteEvent(e){await s.pR.from("photos").delete().eq("event_id",e),await s.pR.from("messages").delete().eq("event_id",e);let{error:t}=await s.pR.from("events").delete().eq("id",e);if(t)throw Error(`Delete event failed: ${t.message}`)}async createPhoto(e){let{data:t,error:r}=await s.pR.from("photos").insert({id:crypto.randomUUID(),event_id:e.event_id,filename:e.filename,original_name:e.original_name,url:e.url,uploader_name:e.uploader_name||null,album_name:e.album_name||"Tamu",likes:0}).select().single();if(r)throw Error(`Create photo failed: ${r.message}`);return t}async getEventPhotos(e){let{data:t,error:r}=await s.pR.from("photos").select("*").eq("event_id",e).order("uploaded_at",{ascending:!1});if(r)throw Error(`Get photos failed: ${r.message}`);return t||[]}async getHomepagePhotos(){let{data:e,error:t}=await s.pR.from("photos").select("*").eq("event_id","homepage").order("uploaded_at",{ascending:!1});if(t)throw Error(`Get homepage photos failed: ${t.message}`);return e||[]}async getPhotoById(e){let{data:t,error:r}=await s.pR.from("photos").select("*").eq("id",e).single();if(r&&"PGRST116"!==r.code)throw Error(`Get photo failed: ${r.message}`);return t}async deletePhoto(e){let{error:t}=await s.pR.from("photos").delete().eq("id",e);if(t)throw Error(`Delete photo failed: ${t.message}`)}async getRecentPhotos(e=8){let{data:t,error:r}=await s.pR.from("photos").select("*").order("uploaded_at",{ascending:!1}).limit(e);if(r)throw Error(`Get recent photos failed: ${r.message}`);return t||[]}async createMessage(e){let{data:t,error:r}=await s.pR.from("messages").insert({id:crypto.randomUUID(),event_id:e.event_id,guest_name:e.guest_name,message:e.message,hearts:0}).select().single();if(r)throw Error(`Create message failed: ${r.message}`);return t}async getEventMessages(e){let{data:t,error:r}=await s.pR.from("messages").select("*").eq("event_id",e).order("created_at",{ascending:!1});if(r)throw Error(`Get messages failed: ${r.message}`);return t||[]}async updateMessageHearts(e,t){let{error:r}=await s.pR.from("messages").update({hearts:t}).eq("id",e);if(r)throw Error(`Update message hearts failed: ${r.message}`)}async getStats(){let[e,t,r]=await Promise.all([s.pR.from("events").select("id",{count:"exact",head:!0}),s.pR.from("photos").select("id",{count:"exact",head:!0}),s.pR.from("messages").select("id",{count:"exact",head:!0})]);if(e.error)throw Error(`Get events count failed: ${e.error.message}`);if(t.error)throw Error(`Get photos count failed: ${t.error.message}`);if(r.error)throw Error(`Get messages count failed: ${r.error.message}`);return{totalEvents:e.count||0,totalPhotos:t.count||0,totalMessages:r.count||0}}}let o=new a},6517:(e,t,r)=>{"use strict";r.d(t,{$6:()=>o,FW:()=>l,_I:()=>n,cT:()=>i,pR:()=>a});var s=r(1971);(0,s.eI)("https://azspktldiblhrwebzmwq.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImF6c3BrdGxkaWJsaHJ3ZWJ6bXdxIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTM5NDQwNDQsImV4cCI6MjA2OTUyMDA0NH0.uKHB4K9hxUDTc0ZkwidCJv_Ev-oa99AflFvrFt_8MG8");let a=(0,s.eI)("https://azspktldiblhrwebzmwq.supabase.co",process.env.SUPABASE_SERVICE_ROLE_KEY,{auth:{autoRefreshToken:!1,persistSession:!1}}),o=process.env.SUPABASE_STORAGE_BUCKET||"hafiportrait-photos";async function i(e,t){let{data:r,error:s}=await a.storage.from(o).upload(t,e,{cacheControl:"3600",upsert:!1});if(s)throw Error(`Upload failed: ${s.message}`);let{data:i}=a.storage.from(o).getPublicUrl(r.path);return i.publicUrl}async function n(e){let{error:t}=await a.storage.from(o).remove([e]);if(t)throw Error(`Delete failed: ${t.message}`)}function l(e,t,r){let s=Date.now(),a=Math.random().toString(36).substring(2,8),o=t.split(".").pop(),i=`${s}_${a}.${o}`;return r?`${e}/${r}/${i}`:`${e}/${i}`}}};var t=require("../../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[638,249],()=>r(1010));module.exports=s})();